#+Title: 400A - Convection & MLT
#+author: Mathieu Renzo
#+email: mrenzo@arizona.edu

* Energy transport in stars 2/2
*Materials*: Kippenhahn's book Ch. 6 and 7, Cox & Giuli vol. 1 Ch. 14,
 Schwarzschild Ch. 7, [[https://ui.adsabs.harvard.edu/abs/2022ApJS..262...19J/abstract][Jermyn et al. 2022]], [[https://ui.adsabs.harvard.edu/abs/2022ApJ...926..169A/abstract][Anders et al. 2022]], [[http://online.kitp.ucsb.edu/online/stars17/cantiello2][Matteo
 Cantiello's talk at KITP in 2017]]

In the [[./notes-lecture-ETransport.org][previous lecture on energy transport]] we have dealt with the
situation where energy diffusion (carried by photons, i.e., radiative
energy transport, or carried by electrons, i.e., conductive energy
transport) is sufficient to sustain the star. However, this is /not/
always the case! For example, we know this is not the case in the
outer layers of the Sun, we can [[https://apod.nasa.gov/apod/ap200203.html][directly see that]]:

[[https://youtu.be/CCzl0quTDHw?si=RUwZfN5SrO1abD1Y][Sun granules]]

We can also see this is not the case in the envelopes of red
supergiants, as for example Betelgeuse, VY Canis Majoris, etc. Less
directly, we can also infer this to happen in the cores of massive
stars: /some stellar layers are not stably stratified and energy
transport is not only diffusive/.

* Convection

In this lecture we will deal with convection, which allows for /energy
transport through macroscopic motion of matter/ resulting in a
/non-zero energy flux with a zero matter flux/.

Convection involves turbulence (the "last" open problem of classical
physics), and is because of this inherently multi-dimensional. Because
of this, convection is usually one of the most approximate ingredients
in stellar calculations, and often the root of many open problems.

Convection is a /thermal/ instability (as we will see it kicks in if the
temperature gradient is steeper than some threshold condition), and it
is a phenomenon that is /not/ unique to stars: the monsoon clouds in
Tucson's summer are also manifestation of convection in the Earth
atmosphere!

Before discussing the details of the physics of convection by using
oversimplified pictures dating back to [[https://en.wikipedia.org/wiki/Ludwig_Prandtl][Prandtl]], have a look at the
following animations of multi-dimensional simulations of convection,
these are probably/hopefully closer to reality than many of the
oversimplifications we will use later in this lecture.

It is important to keep in mind that we adopt modeling simplifications
to make the simulation of stars tractable, but these introduce
systematic uncertainties which are active topic of research.

** Core convection in a massive star ([[https://ui.adsabs.harvard.edu/abs/2022ApJ...926..169A/abstract][Anders et al. 2022]])

  [[https://vimeo.com/684826914]]

  This is a simulation of the temperature fluctuations (right) and
  vertical velocities (left) in "code units" using the code [[https://github.com/DedalusProject/dedalus][Dedalus]].

** Envelope convection in a red super-giant ([[https://ui.adsabs.harvard.edu/abs/2022ApJ...929..156G/abstract][Goldberg et al. 2022]])

 [[https://youtu.be/Cq5EqDkXFhQ]]

 This is a 3D radiation-hydrodynamics simulation of large portions of
 the envelope of a red supergiant (not that different from
 Betelgeuse), computed with the [[https://www.athena-astro.app/][ATHENA++]] code.

** Thermonuclear runaway during a Nova explosion ([[https://ui.adsabs.harvard.edu/abs/2018A%26A...619A.121C/abstract][Casanova et al. 2018]])

 [[./images/125M-ONe-3.wmv]]

 This is a 2D simulation of convection developing during a nova
 explosion using the [[https://flash.rochester.edu/site/][FLASH]] code. The movie shows the (log_{10}) mass
 fraction of neon 20, and is taken from [[http://www.fen.upc.edu/users/jjose/][J. Jordi's personal webpage]]
 (one of the co-authors).

* The timescale for convection

We can define a timescale associated to the macroscopic motion of
matter with net zero flux that is carrying energy \tau_{conv} = \Delta r/v_{conv}.
This is the "convective turnover timescale", where \Delta r is the spatial
extent of a convective region, and v_{conv} is the velocity of the blobs
of matter moving around.

In the following we will see how to find \Delta r and get an estimate of
v_{conv}.

:Question:
- *Q*: We have already encountered two /global/ timescales relevant to
  stars, the free fall timescale \tau_{ff} and the Kelvin-Helmholtz
  timescale \tau_{KH}. \tau_{conv} is instead a /local/ timescale, relevant only
  to the convective layers. How do you think it compares to the two
  global timescales we have defined?
:end:

Since convection is an /instability/ we expect that it kicks in when the
stability of the matter stratification and transport of energy by the
other mechanisms we have already discussed breaks down: /convection
occurs if energy diffusion is insufficient to carry the flux/.

How convection exactly turns on/off and especially how to treat this
in stellar evolution models is still a debated issue - but we can
construct a [[*Convective stability criterion: Schwarzschild & Ledoux criterion][stability criterion]], which when violated means we expect
convection to develop, and [[*Mixing length theory][later on]] we will develop a theoretical
model for the time- and spatially- averaged steady state which we
expect to develop when the convective instability saturates.
Hopefully, stellar /evolution/ timescales are long enough that
describing the averaged steady state resulting from convection is
sufficient for our purposes (but there are exceptions, for example
during explosions of when looking at phenomena on timescales shorter
than \tau_{conv}).

* Convective stability criterion: Schwarzschild & Ledoux criterion

#+CAPTION: Skematic picture of the convective stability based on Prandtl oversimplified "bubble picture". The right panel shows the gradients. This is Fig. 5.3 in Onno Pols' lecture notes.
#+ATTR_HTML: :width 100%
[[./images/conv_blobs.png]]

To derive a stability criterion, let's assume to start from a stable
situation, where the temperature gradient is determined by the
(radiative) diffusion of energy: dT/dr \propto \kappa L/(4\pi r^{2}).

Let's consider a parcel of gas initially in equilibrium with its
surroundings at pressure P_{1} and density \rho_{1}. To determine a stability
criterion, let's perturb such parcel by displacing it by a certain
(small) amount d and discuss how the parcel reacts: if things act to
move the parcel of gas back towards its original position we have a
stable situation, if instead a seed initial displacement d result in
more displacement, we have an unstable situation.

As the gas parcel moves, we can assume it maintains hydrostatic
equilibrium with the surrounding: we are looking for a thermal
instability that acts on a longer timescale than dynamical timescale.
Moreover, if this were not the case, any pressure imbalance would be
equalized through sound-waves. Therefore, throughout the path d and at
the final position we have P_{bubble} = P_{environment}.

Let's calculate the density. Since we assume d to be "small" (w.r.t.
the relevant spatial scales in the star), a first order approximation
is sufficient: \rho_{bubble} = \rho_{1} + (d\rho/dr)_{ad} d. The relevant way to calculate
d\rho/dr here is to assume that the gas parcel moves /adiabatically/: there
is no time for heat exchange, dq=0, and the specific entropy of the
bubble remains constant ds = 0 (recall thermodynamics!).

We want to compare \rho_{bubble} after the displacement by d to the
environment density. Once again we can use a first order
approximation, but for the environment we have assumed an initially
stable stratification, meaning d\rho/dr is not adiabatic, but the
radiative gradient (which you can obtain from dT/dr for radiative
transport and the EOS). Therefore \rho_{2} = \rho_{1} + (d\rho/dr)_{env }d \equiv
\rho_{1} + (d\rho/dr)_{rad }d, because we are assuming the surrounding
environment to be in radiative equilibrium (and assessing the
stability of that equilibrium).

*N.B.:* we have derived an equation for dT/dr in radiative equilibrium
(i.e., when the energy is transported by the diffusion of photons),
which combined with the EOS can be turned into (d\rho/dr)_{rad}.

*N.B.:* In reality, the "bubble" picture is a gross oversimplification.
In a convective layer what really moves around are "flux tubes" of
thermal energy carried by gas, but there is not a true "bubbling". A
common misconception is that water boiling is exhibiting convection:
that is not exactly correct. Water boiling is /by definition/ a phase
transition from liquid to gas, however, shortly before the phase
transition occurs, it is true that conduction in the water is
typically insufficient to carry the energy release at the bottom, and
convective motion can be spotted as a small simmering of the water
breaking down into small waves.

** Instability condition
Comparing the density of the displaced bubble \rho_{bubble} to the density of the
environment \rho_{2} we can determine a condition for instability. If
\rho_{Bubble} \leq \rho_{2} then there will be a buoyant force acting to
displace it further up (Archimedes force, the bubble displaces a
volume of fluid heavier than its own weight!):


#+begin_latex
\begin{equation}\label{eq:instability_crit}
\mathrm{Instability\ if:} \ \rho_\mathrm{Bubble} \leq \rho_{2}  \Rightarrow
\left(\frac{d\rho}{dr}\right)_\mathrm{ad} \leq
\left(\frac{d\rho}{dr}\right)_\mathrm{env} \equiv \left(\frac{d\rho}{dr}\right)_\mathrm{rad} \ \ .
\end{equation}
#+end_latex

Therefore, the density stratification for radiative energy transport
is /unstable w.r.t. buoyancy forces/ *if* the density gradient (d\rho/dr)_{rad}
is larger than the adiabatic gradient (d\rho/dr)_{ad}: if the gradient is
/too steep/ then radiative diffusion is not sufficient to carry the
energy flux and convection kicks in, and the threshold defining what
is /too steep/ is the adiabatic gradient. This is the criterion derived
by [[https://en.wikipedia.org/wiki/Martin_Schwarzschild][Martin Schwarzschild]], however, in stellar physics textbooks it is
often re-written in a slightly different form.

*** Schwarzschild criterion

For the same reason why we tend to use the Lagrangian enclosed mass as
independent coordinate in stellar calculation, it is unpractical to
use the derivatives w.r.t. radius when trying to determine whether the
stratification of gas is stable or not. For example, a red supergiant
envelope (which is convective!) has a radial extent of \sim 100-1000s of
R_{\odot}. Moreover, since we are only dealing with properties of the
stellar gas here, it is more practical to use as independent
coordinate something else that is more directly related to the gas
itself. The common choice is to use the pressure P itself.

*N.B.:* P(r) is also monotonically increasing outwards because of the
hydrostatic equilibrium equation, much like m(r) is, so it is a valid
variable to use as independent coordinate.

Furthermore, it is helpful to rewrite this in terms of temperature
gradients instead of density gradients. These changes of variables,
assuming an ideal gas EOS with constant mean molecular weight \mu allow
to re-write \ref{eq:instability_crit} in the form most commonly called
Schwarzschild criterion:

#+begin_latex
\begin{equation}\label{eq:schwarzschild_crit}
\mathrm{Instability\ if:} \ \frac{\partial \log(T)}{\partial \log(P)}_\mathrm{rad} = \nabla_\mathrm{rad} > \frac{\partial \log(T)}{\partial \log(P)}_\mathrm{ad} = \nabla_\mathrm{ad} \ \ ,
\end{equation}
#+end_latex
with \mu = constant. Note that from the radiative transport equation we
can directly obtain \nabla_{rad}

#+begin_latex
\begin{equation}\label{eq:nabla_rad}
\nabla_\mathrm{rad} = \frac{3\kappa L P}{64\pi G m \sigma T^{4}} \propto \kappa L\ \ ,
\end{equation}
#+end_latex

So we see immediately that this is going to be large, and prone to
convective instability in regions where there is a large opacity \kappa \equiv
\kappa(m) and/or regions with a large luminosity L \equiv L(m).

*** Ledoux criterion
In a star, \mu is /not/ always constant: as we have already seen there can
be regions of /partial ionization/ where \mu changes as we move through
them, and we already know that in the fully ionized inner regions of
the star we have \mu \simeq 1/(2X+3Y/4+Z/2) so as we convert hydrogen into
helium in the core (and later on helium into metals), we also expect \mu
to change. We can thus rewrite the instability condition
\ref{eq:instability_crit} without assuming \mu = constant.

To do this, it may be helpful to write the EOS functional dependence
in a very general form P\equiv P(\rho, T, {X_{i}}) \equiv P(\rho, T, \mu). By
differentiating this we obtain

#+begin_latex
\begin{equation}
\frac{d\rho}{\rho} = \alpha \frac{dP}{P} -\delta \frac{dT}{T} +\varphi \frac{d\mu}{\mu} \ \ ,
\end{equation}
#+end_latex
where \alpha, \delta, and \varphi are coefficients that depend on the details of the
EOS, but known as long as the EOS is known.

We can then rewrite \ref{eq:instability_crit} as

#+begin_latex
\begin{equation}\label{eq:ledoux_crit}
\mathrm{Instability\ if:} \nabla_\mathrm{rad} \geq \nabla_\mathrm{ad} + \frac{\varphi}{\delta} \nabla_{\mu} \ \ ,
\end{equation}
#+end_latex
with \nabla_{\mu} = \partial log(\mu)/\partial\log(P). Eq.
\ref{eq:ledoux_crit} is usually referred to as the Ledoux criterion
([[https://ui.adsabs.harvard.edu/abs/1947ApJ...105..305L/abstract][Ledoux 1947]]).

*** Secular mixing processes: semiconvection and thermohaline mixing
For stellar layers that are stable according to the Ledoux criterion
but unstable according to the Schwarzschild criterion as we have
defined them above, that is

#+begin_latex
\begin{equation}\label{eq:semiconv_crit}
\nabla_\mathrm{ad} \le \nabla_\mathrm{rad}  \leq \nabla_\mathrm{ad} + \frac{\varphi}{\delta} \nabla_{\mu} \ \ ,
\end{equation}
#+end_latex

the chemical potential gradient acts as a stabilizing force. There
will /not/ be a full blown instability, but rather, in the approximate
toy model we have used to derive the instability criterion, the gas
parcels will experience small oscillations where the \mu gradient acts
as a damping force. This is the so called *semiconvection*.

Viceversa, if a layer is Schwarzschild stable but Ledoux unstable:

#+begin_latex
\begin{equation}\label{eq:thermohaline_crit}
\nabla_\mathrm{ad} + \frac{\varphi}{\delta} \nabla_{\mu} \le \nabla_\mathrm{rad}  \leq \nabla_\mathrm{ad} \ \ ,
\end{equation}
#+end_latex
then the mean molecular weight gradient acts to /destabilize/ the layer.
In this case, in our simplistic picture, a blob of gas will slowly
start slowly moving because of \nabla_{\mu} but there will be no restoring forces,
and we obtain the so called *thermohaline mixing* or *double diffusion
instability*. The name double diffusion comes from the fact that for
the gas parcel to move it has to diffuse thermal energy to its
environment (which otherwise would stabilize it), as its different
chemical composition also diffuses. This leads to the formation of
long "fingers", as you can [[https://www.stellarphysics.org/thermohaline-mixing][prove in a kitchen experiment]]:

#+CAPTION: Double-diffusive fingers in hot salty water on top of cold fresh water. Credits: M. Cantiello.
#+ATTR_HTML: :width 40%
[[./images/thermohaline.jpg]]

The thermohaline mixing is obviously not only a stellar phenomenon: it
can occur for example in the sea close to the equator, where the
surface is heated by the Sun and evaporates faster, leading to a layer
with hotter and saltier water (higher \mu) on top of colder and less
salty water below.

An example where it occurs in stars are accretors in binaries which
may receive helium enriched material from the outer layers of the core
of the donor star, putting helium rich higher \mu gas on top of the lower \mu
envelope.

*** Which instability criterion should one use?
Naively, one may think that the Ledoux convection is more physically
accurate, since it requires one less hypothesis (which we know to not
always be correct inside a star). This is generally true.

However, when calculating stellar models what we are interested in is
the long-term evolution of the star: as you can see from the
thermohaline mixing figure above, this is not a 1D process (the
"fingers" end with "mushrooms"), and we typically care about
timescales very long compared to the timescales for these processes.
These are in fact /thermal/ processes and their timescales are
proportional to the /local/ thermal timescale, which as we have already
seen is generally short compared to the evolutionary timescale.

Especially for convection in the stellar cores (where we will see
energy is generated, therefore L can be very large, especially in
massive stars and drive convection), convection may flatten the \mu
gradient on a timescale short compared to the main sequence lifetime,
therefore erasing the ingredient that differentiates the two (see for
instance [[https://ui.adsabs.harvard.edu/abs/2022ApJ...926..169A/abstract][Anders et al. 2022]]). This is an active topic of debate in the
recent literature!

* Mixing length theory

Let's now consider what happens in an unstable layer: we need to model
how the energy is transported in these layers, were radiative
diffusion is insufficient and the gas will start moving. A perfect
solution would require to follow the dynamics of buoyant parcels of
gas over the (long) thermal timescale, which is in general /not/
possible: hydrodynamic simulations can only compute the much shorter
/dynamical/ timescales!

Physically, in the unstable situation we have described above, we
should expect macroscopic motion of gas (the "bubbles") to stars, and
these "bubbles" would move upward adiabatically, maintaining
hydrostatic balance with the surroundings, until they release their
excess heat, cooling down and finally falling back. This obviously is
/not/ a one dimensional problem, since we have some bubbles moving
upwards and some moving downwards simultaneously so that the net mass
flux is zero, but the net energy flux is non-zero. Moreover this
typically leads to turbulence in the flow which is an inherently
multi-dimensional problem.

[[https://en.wikipedia.org/wiki/Erika_B%C3%B6hm-Vitense][Erika Bohm-Vitense]] developed in 1957 an effective mean-field theory to
describe the space- and time-averaged steady state at which convective
energy transport would saturare. This is the so-called /mixing length
theory/ (MLT) that is widely applied in stellar evolution still today,
and is based on the simplified "bubble picture" from Prandtl we
already used to derive a stability criterion.

Before deriving the energy flux, and ultimately temperature gradient
in a convective region according to MLT, let's try to get an intuition
for what this very successful, albeit very approximate picture tries
to describe. We can consider a more familiar example of convection for
that, such as a self-sustaining fire:

#+CAPTION: A flame sustains itself by driving convection that brings in more oxygen to allow combustion to happen.
#+ATTR_HTML: :width 50%
[[./images/fire.jpg]]

MLT is meant to describe the spatial and temporal average of the gas
flow in the convective region driven by the (chemical) energy release
from the fire. Intuitively, it's like taking a picture (assuming any
snapshot in time is statistically equivalent to any other), and then
averaging across the horizontal cross section of this fire to obtain
an approximation to the time- and space- averaged vertical flow of
energy and temperature. With all the limitations that this entails,
MLT is a very successful theory that is sufficient for /most/ stellar
evolution applications since those typically are concerned with
timescales that are very long w.r.t. the convective turnover timescale
(i.e., in the fire analogy, very long compared to the "flickering" of
the flames).

:Question:
 - *Q*: based on this, can you guess where/when MLT will be an
   insufficient approximation?
:end:

** Convective energy flux
To calculate the energy flux carried by convection within the
framework of MLT, let's consider the difference in temperature between
a bubble that risen by an amount \ell in an unstable layer (because of
any small perturbation) w.r.t. the surrounding environment:

#+begin_latex
\begin{equation}
\Delta T = T_\mathrm{Bubble} - T_\mathrm{env} = \left(T_{1} + \frac{dT}{dr}_\mathrm{Bubble}\ell \right) - \left(T_{1} + \frac{dT}{dr}_\mathrm{env}\ell \right) = \left(\frac{dT}{dr}_\mathrm{Bubble} - \frac{dT}{dr}_\mathrm{env} \right)\ell \ \ .
\end{equation}
#+end_latex




** Chemical mixing

** Convective velocity vs. thermal velocity

* Limitations of MLT

** Convective boundary mixing (a.k.a. "overshooting")

** Time-dependence

** Efficiency of semiconvection/thermohaline mixing
The processes we have discussed are all inherently multi-dimensional.
Therefore, in their 1D formulation necessary to have stellar structure
and evolution models, we introduce free parameters, such as \alpha_{MLT}
discussed above.

This is also true for thermohaline mixing and semiconvection, each
coming with their poorly known efficiency parameter. Furthermore, we
need to better understand how these mixing processes in the star
interact with each other, with rotation, magnetic fields, etc. Entire
conferences are being dedicated to these topics, e.g. [[https://www.kitp.ucsb.edu/activities/transtar21][KITP "Probes of
transport in stars"]]!
